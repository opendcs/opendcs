name: OpenDCS Build and unit tests
on:
  pull_request:
    branches: ["master"]
  push:
    branches: ["master"]

jobs:
  tests:
    strategy:
      fail-fast: false
      matrix:
        platform: [ubuntu-latest, macos-13, windows-latest]
        jdk: [11, 17]
    runs-on: ${{matrix.platform}}
    steps:
      - uses: actions/checkout@v4.1.1
      - name: Set up JDK
        uses: actions/setup-java@v4.2.1
        with:
          java-version: ${{matrix.jdk}}
          distribution: temurin
      - uses: actions/setup-python@v5.1.0
        with:
          python-version: "3.8"
      - uses: actions/cache@v4.0.2
        with:
          path: ~/.ant
          key: ${{ matrix.platform }}-ivy-${{hashFiles('ivy.xml')}}
          restore-keys: ${{ matrix.platform }}-ivy
      - name: units tests
        run: |
          ./gradlew test --info      
      - name: create installer
        if: matrix.platform == 'ubuntu-latest'
        run: |
          ./gradlew izpack --info
